% !TeX root = ../main.tex

\chapter{THUR-20数据标准及校准技术规范}
\label{cha:chapter02}

\section{THUR-20设计目标}

\section{THUR-20数据标准}
\label{sec:standard}

  THUR-20是一个基于UR5机械臂的的标准化抓取数据集，在采集过程中，它的主要设备
  及传感器组成有：

  \begin{itemize}
    \item 机械部分，UR5机械臂，Robotiq-2f-85夹爪；
    \item 传感器部分，包括视觉传感器以及触觉传感器；
    \item 逻辑控制部分，由一台配有i9 cpu、GeForce2080的笔记本组成；
  \end{itemize}

  符合规范的THUR-20数据应包含经过时间校准的机械臂关节角度序列，夹爪张角序列，
  俯视、斜视以及固定在夹爪手腕上的摄像头图片帧序列，这三个视角的图片序列应当
  全部为RGB-D图像，下面分段详述每个数据形式的具体要求和组织方式。

  数据组织方式：为了使THUR-20数据集标准具有泛化性且新手友好，我们使用一个顶端
  yaml文件维护每种数据流的种类、名字、及是否存在。若某个数据流（例如顶视RGB-D
  数据）在当前数据序列中是存在的，则数据录入者应当在顶层的yaml文件中注册本数据
  流，声明它的名字及数据种类。顶层yaml文件还有一个重要用途，是表明当前任务序列
  对应的任务种类及任务细分类别，e.g. short-task，pick-up。一个典型顶层yaml文件
  应当如下所示：

  BLABLABLA，TODO：贴一个带高亮的yaml文件上来，我还没有写。

  UR5机械臂的关节序列：机械臂的关节角度序列是本数据集的基础所在。本数据集中，
  UR5机械臂的数据帧包含5个部分，分别为：header, name, position, velocity, effort。
  header中存储了当前帧数据对应的时间戳，name为机械臂对应的关节的名字，为字符串
  向量，其后的三个向量中的数据顺序都应当对应name中的关节顺序。position为机械臂
  每个关节的转角，单位为rad；velocity为机械臂每个关节的角速度，单位为rad/s；
  effort为每个关节上检测到的扭矩，单位为Nm。在position，velocity，effort这
  三个数据位中，position是必须量，即若当前帧中不含position向量或者向量长度与
  name中的关节数目不符，则当前帧被判定为非法帧。三个机械臂变量都应当由UR5机械
  臂的驱动获得，数据采集者可以使用本文提供的开源代码直接运行以获取合法的采集数据。
  值得注意的是，velocity的获得依赖采集者使用的UR5机械臂固件的版本，因此本数据
  集允许velocity域为可选项，若采集者无法获得对应数据，将对应向量置为空向量即可。
  effort的获得则以来于机械臂型号的选择，目前只有UR5e系列有力反馈功能，因此，
  这一特性也被留为可选域。最终记录的机械臂关节序列应当存储在一个json文件中，典型
  的数据如下

  BLABLABLA，TODO：贴一个带高亮的json文件上来，数据格式参考ros sensor_msgs/JointState

  Robotiq夹爪张角序列：Robotiq夹爪张角本身数据格式较为简单，但是由于涉及到夹爪的
  安装以及夹爪上连接的摄像头的建模与避障问题，我们要求数据采集者提供夹爪完全的STL
  模型，此模型应当包含夹爪上固连的任何物品（相机以及相机基座），并且我们要求采集
  者给出模型中心到UR5机械臂末端的外参。夹爪张角数据本身应当由三个部分组成：header,
  position, max_effort。其中header中记录了当前帧数据对应的时间戳，position则为
  张角大小，单位为m，max_effort为夹爪电机在当前位置给出的输出力，单位为N。夹爪的stl
  模型应当放在张角序列对应的文件夹内，stl文件名及夹爪到机械臂的外参应当存储在一个
  yaml文件中，典型yaml文件如下所示：

  BLABLABAL，TODO：贴一个夹爪外参的yaml

  夹爪张角本身的数据序列应当存储在一个json文件中，典型的文件数据格式如下：

  BLABLABLA，TODO：贴一个json，control_msgs/GripperCommand


\section{其它例子}
\label{sec:other}

在第~\ref{cha:intro} 章中我们学习了贝叶斯公式~(\ref{equ:chap1:bayes})，这里我们复
习一下：
\begin{equation}
\label{equ:chap2:bayes}
p(y|\vx) = \frac{p(\vx,y)}{p(\vx)}=
\frac{p(\vx|y)p(y)}{p(\vx)}
\end{equation}

\subsection{绘图}
\label{sec:draw}

本模板不再预先装载任何绘图包（如 \pkg{pstricks，pgf} 等），完全由用户来决定。
个人觉得 \pkg{pgf} 不错，不依赖于 Postscript。此外还有很多针对 \LaTeX{} 的
 GUI 作图工具，如 XFig(jFig), WinFig, Tpx, Ipe, Dia, Inkscape, LaTeXPiX,
jPicEdt, jaxdraw 等等。

\subsection{插图}
\label{sec:graphs}

强烈推荐《\LaTeXe{} 插图指南》！关于子图形的使用细节请参看 \pkg{subcaption} 宏包的说明文档。

\subsubsection{一个图形}
\label{sec:onefig}
一般图形都是处在浮动环境中。之所以称为浮动是指最终排版效果图形的位置不一定与源文
件中的位置对应\footnote{This is not a bug, but a feature of \LaTeX!}，这也是刚使
用 \LaTeX{} 同学可能遇到的问题。如果要强制固定浮动图形的位置，请使用 \pkg{float} 宏包，
它提供了 \texttt{[H]} 参数，比如图~\ref{fig:xfig1}。
\begin{figure}[H] % use float package if you want it here
  \centering
  \includegraphics{thu-whole-logo.pdf}
  \caption{利用 Xfig 制图}
  \label{fig:xfig1}
\end{figure}

大学之道，在明明德，在亲民，在止于至善。知止而后有定；定而后能静；静而后能安；安
而后能虑；虑而后能得。物有本末，事有终始。知所先后，则近道矣。古之欲明明德于天
下者，先治其国；欲治其国者，先齐其家；欲齐其家者，先修其身；欲修其身者，先正其心；
欲正其心者，先诚其意；欲诚其意者，先致其知；致知在格物。物格而后知至；知至而后
意诚；意诚而后心正；心正而后身 修；身修而后家齐；家齐而后国治；国治而后天下
平。自天子以至于庶人，壹是皆以修身为本。其本乱而未治者 否矣。其所厚者薄，而其所
薄者厚，未之有也！

\hfill —— 《大学》


\subsubsection{多个图形}
\label{sec:multifig}

如果多个图形相互独立，并不共用一个图形计数器，那么
用 \texttt{minipage} 或者\texttt{parbox} 就可以。否则，请参看
图~\ref{fig:big1-subcaptionbox}，它包含两个小图，分别是图~\ref{fig:subfig1}和
图~\ref{fig:subfig2}。推荐使用 \cs{subcaptionbox}，因为可以像
图~\ref{fig:big1-subcaptionbox} 那样对齐子图的标题，也可以使用 \pkg{subcaption}
宏包的 \cs{subcaption}（放在 minipage中，用法同\cs{caption}）或
是 \pkg{subfigure} 、\pkg{subtable}环境，像图~\ref{fig:big1-subfigure}，不要再
用 \cs{subfloat}、\cs{subfigure} 和 \cs{subtable}。

\begin{figure}[h]
  \centering%
  \subcaptionbox{第一个小图形\label{fig:subfig1}}[3cm] %标题的长度，超过则会换行，如下一个小图。
    {\includegraphics[height=3cm]{thu-fig-logo.pdf}}%
  \hspace{4em}%
  \subcaptionbox{第二个小图形，注意这个图略矮些。如果标题很长的话，它会自动换行\label{fig:subfig2}}
      {\includegraphics[height=2cm]{thu-text-logo.pdf}}
  \caption{包含子图形的大图形(subcaptionbox示例)}
  \label{fig:big1-subcaptionbox}
\end{figure}
\begin{figure}[h]
  \centering%
  \begin{subfigure}{3cm}
    \includegraphics[height=3cm]{thu-fig-logo.pdf}
    \caption{第一个小图形}
  \end{subfigure}%
  \hspace{4em}%
  \begin{subfigure}{0.5\textwidth}
    \includegraphics[height=2cm]{thu-text-logo.pdf}
    \caption{第二个小图形，注意这个图略矮些。subfigure中同一行的子图在顶端对齐。}
  \end{subfigure}
  \caption{包含子图形的大图形(subfigure示例)}
  \label{fig:big1-subfigure}
\end{figure}

古之学者必有师。师者，所以传道受业解惑也。人非生而知之者，孰能无惑？惑而不从师，
其为惑也，终不解矣。生乎吾前，其闻道也固先乎吾，吾从而师之；生乎吾後，其闻道也亦
先乎吾，吾从而师之。吾师道也，夫庸知其年之先後生於吾乎！是故无贵无贱无长无少，道
之所存，师之所存也。

嗟乎！师道之不传也久矣，欲人之无惑也难矣。古之圣人，其出人也远矣，犹且从师而问焉；
今之众人，其下圣人也亦远矣，而耻学於师。是故圣益圣，愚益愚。圣人之所以为圣，愚
人之所以为愚，其皆出於此乎？爱其子，择师而教之，於其身也，则耻师焉，惑焉。彼童子
之师，授之书而习其句读者，非吾所谓传其道、解其惑者也。句读之不知，惑之不解，或师
焉，或不焉，小学而大遗，吾未见其明也。巫医、乐师、百工之人不耻相师，  士大夫之族
曰“师”曰“弟子”之云者，则群聚而笑之。问之，则曰：彼与彼年相若也，道相似也，位
卑则足羞，官盛则近谀。呜呼！师道之不复，可知矣。巫医、乐师、百工之人。吾子不齿，
今其智乃反不能及，其可怪也欤！圣人无常师。孔子师郯子、苌子、师襄、老聃。郯子之徒，
其贤不及孔子。孔子曰：“三人行，必有我师。”是故弟子不必不如师，师不必贤於弟子。
闻道有先後，术业有专攻，如是而已。

如果要把编号的两个图形并排，那么小页就非常有用了：
\begin{figure}
\begin{minipage}{0.48\textwidth}
  \centering
  \includegraphics[height=2cm]{thu-whole-logo.pdf}
  \caption{并排第一个图}
  \label{fig:parallel1}
\end{minipage}\hfill
\begin{minipage}{0.48\textwidth}
  \centering
  \includegraphics[height=2cm]{thu-whole-logo.pdf}
  \caption{并排第二个图}
  \label{fig:parallel2}
\end{minipage}
\end{figure}

李氏子蟠，年十七，好古文、六艺，经传皆通习之，不拘於时，学於余。余嘉其能行古
道，作师说以贻之。

\hfill —— 韩愈（唐）
